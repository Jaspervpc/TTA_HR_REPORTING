{
	"name": "200_PERSONIO_DATA_bis_202301",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "PersonioASCII_bis_202301",
						"type": "DatasetReference"
					},
					"name": "PersonioASCII",
					"description": "Daten aus PersonioASCII importieren"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "200_Personio_Data",
						"type": "DatasetReference"
					},
					"name": "Personio"
				}
			],
			"transformations": [
				{
					"name": "LOADDatum"
				},
				{
					"name": "filter1"
				},
				{
					"name": "abgSp"
				},
				{
					"name": "cast1"
				}
			],
			"scriptLines": [
				"parameters{",
				"     PYear as string ('2023'),",
				"     PMonth as string ('04')",
				"}",
				"source(output(",
				"          Status as string,",
				"          ID as string,",
				"          {E-Mail} as string,",
				"          Name as string,",
				"          { Vorname} as string,",
				"          Abteilung as string,",
				"          Alter as string,",
				"          {Mitarbeitergruppen nach Anstellungsart} as string,",
				"          Anstellungsdatum as string,",
				"          Anstellungsart as string,",
				"          {Mitarbeitergruppen nach Funktion} as string,",
				"          Austrittsart11 as string,",
				"          Austrittsart12 as string,",
				"          {Austrittsdatum (aktueller Beschäftigungszeitraum)} as string,",
				"          {Betriebsstätte} as string,",
				"          {Betriebszugehörigkeit (in Jahren)} as string,",
				"          {Eintrittsdatum (aktueller Beschäftigungszeitraum)} as string,",
				"          {Ende des Arbeitsverhältnisses} as string,",
				"          Ersteintrittsdatum as string,",
				"          FTE as string,",
				"          Geschlecht as string,",
				"          Gesellschaft as string,",
				"          {Grad der Schwerbehinderung} as string,",
				"          Kostenstelle as string,",
				"          {Kündigung (Datum)} as string,",
				"          {Kündigungsgrund} as string,",
				"          {Mitarbeiterzahl (Status „Aktiv“ und „Auszeit“)} as string,",
				"          {DATEV Personalnummer} as string,",
				"          Position as string,",
				"          Wochenstunden as string,",
				"          {Bad Churn} as string,",
				"          Arbeitsunfall as string,",
				"          {Arbeitsbedingter Todesfall} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     wildcardPaths:[(concat('Personio/Schnittstelle_vor_Personio/Data_', $PYear, '_', $PMonth, '.csv'))]) ~> PersonioASCII",
				"cast1 derive(LoadDatum = currentTimestamp(),",
				"          LoadPeriode = concat($PYear, $PMonth),",
				"          Betriebszuge = toInteger({Betriebszugehörigkeit (in Jahren)})) ~> LOADDatum",
				"PersonioASCII filter(!isNull(Gesellschaft)) ~> filter1",
				"LOADDatum derive(vFTE = toDecimal(FTE, 27, 4, '#,##', 'de'),",
				"          Anstellungsdauer = toDecimal(Betriebszuge),",
				"          AktiveMA = toDecimal({Mitarbeiterzahl (Status „Aktiv“ und „Auszeit“)}, 27, 4, '#,##', 'de'),",
				"          WochenStd = toDecimal(Wochenstunden, 27, 4, '#,##', 'de')) ~> abgSp",
				"filter1 cast(output(",
				"          Alter as decimal(10,0) '000,000,000.000',",
				"          {Betriebszugehörigkeit (in Jahren)} as decimal(10,0) '000,000,000.000'",
				"     ),",
				"     errors: true) ~> cast1",
				"abgSp sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          STATUS as string,",
				"          ID as string,",
				"          MAILADDRESS as string,",
				"          FIRSTNAME as string,",
				"          LASTNAME as string,",
				"          DEPARTMENT as string,",
				"          AGE as decimal(27,4),",
				"          HIRED_AS as string,",
				"          HIRE_DATE as date,",
				"          EMPLOYMENT_TYPE as string,",
				"          EMPLOYEE_GROUPS_BY_FUNCTION as string,",
				"          EXIT_TYPE as string,",
				"          EXIT_TYPE_2 as string,",
				"          LEAVING_DATE_CURRENT_EMPLOYMENT_PERIOD as date,",
				"          PLACE_OF_BUSINESS as string,",
				"          LENGTH_OF_EMPLOYMENT_IN_YEARS as decimal(27,4),",
				"          ENTRY_DATE_CURRENT_EMPLOYMENT_PERIOD as date,",
				"          END_OF_EMPLOYMENT as date,",
				"          FIRST_ENTRY_DATE as date,",
				"          FTE as decimal(27,4),",
				"          GENDER as string,",
				"          COMPANY as string,",
				"          DEGREE_OF_SEVERE_DISABILITY as string,",
				"          COST_CENTRE as string,",
				"          TERMINATION_DATE as date,",
				"          REASON_FOR_TERMINATION as string,",
				"          NUMBER_OF_EMPLOYEES_STATUS_ACTIVE_AND_TIME_OFF as decimal(27,4),",
				"          DATEV_PERSONNEL_NUMBER as string,",
				"          POSITION as string,",
				"          WEEKLY_HOURS as decimal(27,4),",
				"          LOAD_PERIOD as string,",
				"          LOAD_TIME as timestamp,",
				"          BAD_CHURN as string,",
				"          ACCIDENT_AT_WORK as string,",
				"          WORKRELATED_DEATH as string,",
				"          COMPANY_KEY as string",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     preSQLs:[(concat('delete from [200_STG].[F_PERSONIO_DATA] WHERE [LOAD_PERIOD] = ', $PYear, $PMonth))],",
				"     dateFormat:'dd.MM.yyyy',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          STATUS = Status,",
				"          ID,",
				"          MAILADDRESS = {E-Mail},",
				"          FIRSTNAME = { Vorname},",
				"          LASTNAME = Name,",
				"          DEPARTMENT = Abteilung,",
				"          AGE = Alter,",
				"          HIRED_AS = {Mitarbeitergruppen nach Anstellungsart},",
				"          HIRE_DATE = Anstellungsdatum,",
				"          EMPLOYMENT_TYPE = Anstellungsart,",
				"          EMPLOYEE_GROUPS_BY_FUNCTION = {Mitarbeitergruppen nach Funktion},",
				"          EXIT_TYPE = Austrittsart11,",
				"          EXIT_TYPE_2 = Austrittsart12,",
				"          LEAVING_DATE_CURRENT_EMPLOYMENT_PERIOD = {Austrittsdatum (aktueller Beschäftigungszeitraum)},",
				"          PLACE_OF_BUSINESS = {Betriebsstätte},",
				"          LENGTH_OF_EMPLOYMENT_IN_YEARS = Anstellungsdauer,",
				"          ENTRY_DATE_CURRENT_EMPLOYMENT_PERIOD = {Eintrittsdatum (aktueller Beschäftigungszeitraum)},",
				"          END_OF_EMPLOYMENT = {Ende des Arbeitsverhältnisses},",
				"          FIRST_ENTRY_DATE = Ersteintrittsdatum,",
				"          FTE = vFTE,",
				"          GENDER = Geschlecht,",
				"          COMPANY = Gesellschaft,",
				"          DEGREE_OF_SEVERE_DISABILITY = {Grad der Schwerbehinderung},",
				"          COST_CENTRE = Kostenstelle,",
				"          TERMINATION_DATE = {Kündigung (Datum)},",
				"          REASON_FOR_TERMINATION = {Kündigungsgrund},",
				"          NUMBER_OF_EMPLOYEES_STATUS_ACTIVE_AND_TIME_OFF = AktiveMA,",
				"          DATEV_PERSONNEL_NUMBER = {DATEV Personalnummer},",
				"          POSITION = Position,",
				"          WEEKLY_HOURS = WochenStd,",
				"          LOAD_PERIOD = LoadPeriode,",
				"          LOAD_TIME = LoadDatum,",
				"          BAD_CHURN = {Bad Churn},",
				"          ACCIDENT_AT_WORK = Arbeitsunfall,",
				"          WORKRELATED_DEATH = {Arbeitsbedingter Todesfall}",
				"     )) ~> Personio"
			]
		}
	}
}